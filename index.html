<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hardware Tracker</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f7;
            margin: 0;
            padding: 0;
            color: #1d1d1f;
        }
        #root {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            font-size: 32px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
        }
        h2 {
            font-size: 24px;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 10px;
        }
        .tabs {
            display: flex;
            justify-content: space-around;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            color: #007aff;
            transition: background-color 0.3s;
        }
        .tab.active {
            background-color: #007aff;
            color: #ffffff;
        }
        .form, .order-list, .settings-section {
            background-color: #ffffff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        input {
            flex: 1;
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 16px;
        }
        button {
            background-color: #007aff;
            color: #ffffff;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .add-button {
            width: auto;
            padding: 10px 20px;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .delete-button {
            background-color: #ff3b30;
            padding: 8px 16px;
            margin-left: 10px;
        }
        .delete-button:hover {
            background-color: #d9362b;
        }
        .status-button {
            background-color: #34c759;
            margin-top: 10px;
            width: 100%;
        }
        .archive-button {
            background-color: #ff9500;
            width: 100%;
        }
        .error {
            color: #ff3b30;
            text-align: center;
        }
        .loading {
            text-align: center;
            font-size: 18px;
            color: #007aff;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React and Babel CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase Compat CDNs for namespaced API -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/11.10.0/firebase-app-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/11.10.0/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/11.10.0/firebase-firestore-compat.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [user, setUser] = useState(null);
            const [tab, setTab] = useState('Incoming');
            const [orders, setOrders] = useState([]);
            const [sets, setSets] = useState([]);
            const [receivers, setReceivers] = useState([]);
            const [newSetName, setNewSetName] = useState('');
            const [newReceiverName, setNewReceiverName] = useState('');
            const [item, setItem] = useState('');
            const [quantity, setQuantity] = useState(1);
            const [recipient, setRecipient] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(true);

            const firebaseConfig = {
                apiKey: "AIzaSyCRbUS6L7O4I_gGaaCmCyHi7wt_WgMwZFc",
                authDomain: "set-hardware.firebaseapp.com",
                projectId: "set-hardware",
                storageBucket: "set-hardware.firebasestorage.app",
                messagingSenderId: "613195230835",
                appId: "1:613195230835:web:c9e3e78db3e8b99f6ec406"
            };

            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }

            const auth = firebase.auth();
            const db = firebase.firestore();

            useEffect(() => {
                const handleAuth = () => {
                    auth.signInAnonymously()
                        .then(() => setLoading(false))
                        .catch(err => {
                            setError(err.message);
                            setLoading(false);
                        });
                };

                const unsubscribe = auth.onAuthStateChanged(currentUser => {
                    setUser(currentUser);
                    if (!currentUser) {
                        handleAuth();
                    } else {
                        setLoading(false);
                    }
                });

                return unsubscribe;
            }, []);

            useEffect(() => {
                if (user) {
                    const unsubscribeOrders = db.collection('orders').where('orderedBy', '==', user.uid).onSnapshot(snapshot => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setOrders(data);
                    });

                    const unsubscribeSets = db.collection('sets').where('userId', '==', user.uid).onSnapshot(snapshot => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setSets(data);
                    });

                    const unsubscribeReceivers = db.collection('receivers').where('userId', '==', user.uid).onSnapshot(snapshot => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setReceivers(data);
                    });

                    return () => {
                        unsubscribeOrders();
                        unsubscribeSets();
                        unsubscribeReceivers();
                    };
                }
            }, [user]);

            const handleOrder = () => {
                db.collection('orders').add({
                    item,
                    quantity,
                    recipient,
                    orderedBy: user.uid,
                    status: 'ordered',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                setItem('');
                setQuantity(1);
                setRecipient('');
            };

            const updateStatus = (id, newStatus) => {
                db.collection('orders').doc(id).update({ status: newStatus });
            };

            const addSet = () => {
                if (newSetName.trim()) {
                    db.collection('sets').add({
                        name: newSetName,
                        userId: user.uid
                    });
                    setNewSetName('');
                }
            };

            const deleteSet = (id) => {
                db.collection('sets').doc(id).delete();
            };

            const addReceiver = () => {
                if (newReceiverName.trim()) {
                    db.collection('receivers').add({
                        name: newReceiverName,
                        userId: user.uid
                    });
                    setNewReceiverName('');
                }
            };

            const deleteReceiver = (id) => {
                db.collection('receivers').doc(id).delete();
            };

            const filteredOrders = orders.filter(order => {
                if (tab === 'Incoming') return order.status === 'ordered';
                if (tab === 'Received') return order.status === 'received';
                if (tab === 'Archived') return order.status === 'archived';
                return false;
            });

            if (loading) {
                return <div className="loading">Loading...</div>;
            }

            if (error) {
                return <p className="error">{error}</p>;
            }

            return (
                <div>
                    <h1>Hardware Tracker</h1>
                    <div className="tabs">
                        {['Incoming', 'Received', 'Archived', 'Order', 'Settings'].map(t => (
                            <div
                                key={t}
                                className={`tab ${tab === t ? 'active' : ''}`}
                                onClick={() => setTab(t)}
                            >
                                {t}
                            </div>
                        ))}
                    </div>
                    {tab === 'Order' ? (
                        <div className="form">
                            <input value={item} onChange={e => setItem(e.target.value)} placeholder="Item" />
                            <input type="number" value={quantity} onChange={e => setQuantity(e.target.value)} />
                            <input value={recipient} onChange={e => setRecipient(e.target.value)} placeholder="Recipient" />
                            <button onClick={handleOrder}>Place Order</button>
                        </div>
                    ) : tab === 'Settings' ? (
                        <div className="settings-section">
                            <h2>Set Names</h2>
                            <div className="input-group">
                                <input value={newSetName} onChange={e => setNewSetName(e.target.value)} placeholder="New Set Name" />
                                <button className="add-button" onClick={addSet}>Add</button>
                            </div>
                            <ul>
                                {sets.map(s => (
                                    <li key={s.id}>
                                        {s.name}
                                        <button className="delete-button" onClick={() => deleteSet(s.id)}>Delete</button>
                                    </li>
                                ))}
                            </ul>

                            <h2>Receiver Names</h2>
                            <div className="input-group">
                                <input value={newReceiverName} onChange={e => setNewReceiverName(e.target.value)} placeholder="New Receiver Name" />
                                <button className="add-button" onClick={addReceiver}>Add</button>
                            </div>
                            <ul>
                                {receivers.map(r => (
                                    <li key={r.id}>
                                        {r.name}
                                        <button className="delete-button" onClick={() => deleteReceiver(r.id)}>Delete</button>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    ) : (
                        <ul className="order-list">
                            {filteredOrders.map(order => (
                                <li key={order.id}>
                                    {order.item} (Qty: {order.quantity}) for {order.recipient}
                                    {tab === 'Incoming' && <button className="status-button" onClick={() => updateStatus(order.id, 'received')}>Mark Received</button>}
                                    {tab === 'Received' && <button className="archive-button" onClick={() => updateStatus(order.id, 'archived')}>Archive</button>}
                                </li>
                            ))}
                        </ul>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
