<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hardware Tracking</title>
  <script id="firebase-app" src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script id="firebase-firestore" src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    body { 
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif; 
      margin: 0; 
      background-color: #f7f7f7; 
    }
    .dark body { background-color: #1a1a1a; }
    .header { 
      position: fixed; 
      top: 0; 
      left: 0; 
      right: 0; 
      background-color: #ffffff; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
      z-index: 10; 
    }
    .dark .header { background-color: #2d2d2d; }
    .header-content { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 16px; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
    }
    .header h1 { 
      font-size: 24px; 
      font-weight: bold; 
      color: #1a1a1a; 
      margin: 0; 
    }
    .dark .header h1 { color: #ffffff; }
    .toggle-button { 
      background-color: #e5e5e5; 
      color: #1a1a1a; 
      padding: 6px 12px; 
      border-radius: 20px; 
      border: none; 
      font-size: 14px; 
      cursor: pointer; 
    }
    .dark .toggle-button { 
      background-color: #4a4a4a; 
      color: #ffffff; 
    }
    .nav { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 0 16px 16px; 
    }
    .tabs { display: flex; gap: 16px; }
    .tab { 
      padding: 8px 16px; 
      border-radius: 8px; 
      font-size: 14px; 
      font-weight: 500; 
      color: #4a4a4a; 
      cursor: pointer; 
      transition: background-color 0.3s, color 0.3s; 
    }
    .dark .tab { color: #d1d1d1; }
    .tab:hover { background-color: rgba(0,0,0,0.05); }
    .dark .tab:hover { background-color: rgba(255,255,255,0.1); }
    .tab-active { 
      background-color: #007aff; 
      color: #ffffff; 
    }
    .content { 
      max-width: 1200px; 
      margin: 128px auto 24px; 
      padding: 16px; 
      animation: fadeIn 0.3s ease-in; 
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .error { color: #ff3b30; text-align: center; font-size: 16px; }
    .loading { color: #007aff; text-align: center; font-size: 16px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <div id="error" class="error"></div>
  <script>
    // Dependency Loading Status
    window.appStatus = { firebase: { loaded: false, error: null } };
    let currentTab = 'incoming';

    // Firebase Initialization
    function initializeFirebase(attempts = 0, maxAttempts = 30) {
      const errorDiv = document.getElementById('error');
      if (typeof firebase === 'undefined') {
        if (attempts >= maxAttempts) {
          console.error("Firebase failed to load after", maxAttempts, "attempts.");
          window.appStatus.firebase = { loaded: false, error: "Failed to load Firebase. Check your network or try again." };
          errorDiv.innerText = window.appStatus.firebase.error;
          renderUI();
          return;
        }
        console.warn("Firebase not loaded yet. Retrying in 100ms... (Attempt", attempts + 1, ")");
        errorDiv.innerText = "Loading Firebase... (Attempt " + (attempts + 1) + ")";
        setTimeout(() => initializeFirebase(attempts + 1, maxAttempts), 100);
        return;
      }
      try {
        const firebaseConfig = {
          apiKey: "AIzaSyCRbUS6L7O4I_gGaaCmCyHi7wt_WgMwZFc",
          authDomain: "set-hardware.firebaseapp.com",
          projectId: "set-hardware",
          storageBucket: "set-hardware.firebasestorage.app",
          messagingSenderId: "613195230835",
          appId: "1:613195230835:web:c9e3e78db3e8b99f6ec406"
        };
        firebase.initializeApp(firebaseConfig);
        window.firebase = {
          db: firebase.firestore(),
          collection: firebase.firestore.collection,
          addDoc: (collectionRef, data) => collectionRef.add(data),
          getDocs: (collectionRef) => collectionRef.get(),
          updateDoc: (docRef, data) => docRef.update(data),
          doc: firebase.firestore.doc
        };
        window.appStatus.firebase = { loaded: true, error: null };
        console.log("Firebase initialized successfully");
        errorDiv.innerText = '';
        renderUI();
      } catch (error) {
        console.error("Firebase initialization failed:", error);
        window.appStatus.firebase = { loaded: false, error: "Firebase initialization failed: " + error.message };
        errorDiv.innerText = window.appStatus.firebase.error;
        renderUI();
      }
    }

    // Render UI
    function renderUI() {
      const root = document.getElementById('root');
      const errorDiv = document.getElementById('error');
      if (!window.appStatus.firebase.loaded && !errorDiv.innerText) {
        errorDiv.innerText = window.appStatus.firebase.error || 'Loading Firebase...';
      }

      root.innerHTML = `
        <div class="header">
          <div class="header-content">
            <h1>Hardware Tracking</h1>
            <button class="toggle-button" onclick="document.documentElement.className = document.documentElement.className === 'dark' ? '' : 'dark'">Toggle Dark Mode</button>
          </div>
          <nav class="nav">
            <div class="tabs">
              <button class="tab ${currentTab === 'incoming' ? 'tab-active' : ''}" onclick="setTab('incoming')">Incoming</button>
              <button class="tab ${currentTab === 'received' ? 'tab-active' : ''}" onclick="setTab('received')">Received</button>
              <button class="tab ${currentTab === 'archived' ? 'tab-active' : ''}" onclick="setTab('archived')">Archived</button>
              <button class="tab ${currentTab === 'options' ? 'tab-active' : ''}" onclick="setTab('options')">Options</button>
            </div>
          </nav>
        </div>
        <div class="content">
          ${window.appStatus.firebase.loaded ? `
            ${currentTab === 'incoming' ? '<p>Incoming items will be displayed here.</p>' : ''}
            ${currentTab === 'received' ? '<p>Received items will be displayed here.</p>' : ''}
            ${currentTab === 'archived' ? '<p>Archived sets will be displayed here.</p>' : ''}
            ${currentTab === 'options' ? '<p>Order form and buyer options will be displayed here.</p>' : ''}
          ` : `<p class="error">${window.appStatus.firebase.error || 'Loading Firebase...'}</p>`}
        </div>
      `;
    }

    // Tab Switching
    function setTab(tab) {
      currentTab = tab;
      renderUI();
    }

    // Script Load Handlers
    const firebaseAppScript = document.getElementById('firebase-app');
    const firebaseFirestoreScript = document.getElementById('firebase-firestore');
    let firebaseScriptsLoaded = 0;
    function checkFirebaseLoaded() {
      firebaseScriptsLoaded++;
      console.log("Firebase script loaded, count:", firebaseScriptsLoaded);
      if (firebaseScriptsLoaded === 2) {
        initializeFirebase();
      }
    }

    firebaseAppScript.onload = checkFirebaseLoaded;
    firebaseAppScript.onerror = () => {
      console.error("Failed to load Firebase App script.");
      window.appStatus.firebase = { loaded: false, error: "Failed to load Firebase App script." };
      document.getElementById('error').innerText = window.appStatus.firebase.error;
      renderUI();
    };
    firebaseFirestoreScript.onload = checkFirebaseLoaded;
    firebaseFirestoreScript.onerror = () => {
      console.error("Failed to load Firebase Firestore script.");
      window.appStatus.firebase = { loaded: false, error: "Failed to load Firebase Firestore script." };
      document.getElementById('error').innerText = window.appStatus.firebase.error;
      renderUI();
    };

    // Initial Render
    renderUI();
  </script>
</body>
</html>
