<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hardware Tracking</title>
  <script id="react" src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script id="react-dom" src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script id="babel" src="https://cdn.jsdelivr.net/npm/babel-standalone@7.22.9/babel.min.js"></script>
  <script id="firebase-app" src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script id="firebase-firestore" src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    body { 
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif; 
      margin: 0; 
      background-color: #f7f7f7; 
    }
    .dark body { background-color: #1a1a1a; }
    .header { 
      position: fixed; 
      top: 0; 
      left: 0; 
      right: 0; 
      background-color: #ffffff; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
      z-index: 10; 
    }
    .dark .header { background-color: #2d2d2d; }
    .header-content { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 16px; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
    }
    .header h1 { 
      font-size: 24px; 
      font-weight: bold; 
      color: #1a1a1a; 
      margin: 0; 
    }
    .dark .header h1 { color: #ffffff; }
    .toggle-button { 
      background-color: #e5e5e5; 
      color: #1a1a1a; 
      padding: 6px 12px; 
      border-radius: 20px; 
      border: none; 
      font-size: 14px; 
      cursor: pointer; 
    }
    .dark .toggle-button { 
      background-color: #4a4a4a; 
      color: #ffffff; 
    }
    .nav { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 0 16px 16px; 
    }
    .tabs { display: flex; gap: 16px; }
    .tab { 
      padding: 8px 16px; 
      border-radius: 8px; 
      font-size: 14px; 
      font-weight: medium; 
      color: #4a4a4a; 
      cursor: pointer; 
      transition: background-color 0.3s, color 0.3s; 
    }
    .dark .tab { color: #d1d1d1; }
    .tab:hover { background-color: rgba(0,0,0,0.05); }
    .dark .tab:hover { background-color: rgba(255,255,255,0.1); }
    .tab-active { 
      background-color: #007aff; 
      color: #ffffff; 
    }
    .content { 
      max-width: 1200px; 
      margin: 128px auto 24px; 
      padding: 16px; 
      animation: fadeIn 0.3s ease-in; 
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .error { color: #ff3b30; text-align: center; }
    .loading { color: #007aff; text-align: center; }
  </style>
</head>
<body>
  <div id="root"></div>
  <div id="error" class="error"></div>
  <script type="text/javascript">
    // Dependency Loading Status
    window.appStatus = { 
      react: { loaded: false, error: null },
      firebase: { loaded: false, error: null },
      rendering: false
    };

    // Firebase Initialization
    function initializeFirebase(attempts = 0, maxAttempts = 50) {
      if (typeof firebase === 'undefined') {
        if (attempts >= maxAttempts) {
          console.error("Firebase failed to load after", maxAttempts, "attempts.");
          window.appStatus.firebase = { loaded: false, error: "Failed to load Firebase. Check your network." };
          checkAllLoaded();
          return;
        }
        console.warn("Firebase not loaded yet. Retrying in 100ms... (Attempt", attempts + 1, ")");
        setTimeout(() => initializeFirebase(attempts + 1, maxAttempts), 100);
        return;
      }
      try {
        const firebaseConfig = {
          apiKey: "AIzaSyCRbUS6L7O4I_gGaaCmCyHi7wt_WgMwZFc",
          authDomain: "set-hardware.firebaseapp.com",
          projectId: "set-hardware",
          storageBucket: "set-hardware.firebasestorage.app",
          messagingSenderId: "613195230835",
          appId: "1:613195230835:web:c9e3e78db3e8b99f6ec406"
        };
        firebase.initializeApp(firebaseConfig);
        window.firebase = {
          db: firebase.firestore(),
          collection: firebase.firestore.collection,
          addDoc: (collectionRef, data) => collectionRef.add(data),
          getDocs: (collectionRef) => collectionRef.get(),
          updateDoc: (docRef, data) => docRef.update(data),
          doc: firebase.firestore.doc
        };
        window.appStatus.firebase = { loaded: true, error: null };
        console.log("Firebase initialized successfully");
        checkAllLoaded();
      } catch (error) {
        console.error("Firebase initialization failed:", error);
        window.appStatus.firebase = { loaded: false, error: "Firebase initialization failed: " + error.message };
        checkAllLoaded();
      }
    }

    // Check if all dependencies are loaded
    function checkAllLoaded() {
      if (window.appStatus.react.loaded && window.appStatus.firebase.loaded && !window.appStatus.rendering) {
        window.appStatus.rendering = true;
        renderApp();
      } else if (window.appStatus.react.error || window.appStatus.firebase.error) {
        document.getElementById('error').innerText = 
          (window.appStatus.react.error || '') + ' ' + 
          (window.appStatus.firebase.error || '');
      } else {
        document.getElementById('error').innerText = "Loading dependencies...";
      }
    }

    // Script Load Handlers
    const reactScript = document.getElementById('react');
    const reactDomScript = document.getElementById('react-dom');
    const babelScript = document.getElementById('babel');
    const firebaseAppScript = document.getElementById('firebase-app');
    const firebaseFirestoreScript = document.getElementById('firebase-firestore');
    
    let reactScriptsLoaded = 0;
    function checkReactLoaded() {
      reactScriptsLoaded++;
      if (reactScriptsLoaded === 3) { // React, ReactDOM, Babel
        if (typeof React !== 'undefined' && typeof ReactDOM !== 'undefined' && typeof Babel !== 'undefined') {
          window.appStatus.react = { loaded: true, error: null };
          console.log("React and Babel loaded successfully");
        } else {
          window.appStatus.react = { loaded: false, error: "Failed to load React or Babel." };
          document.getElementById('error').innerText = window.appStatus.react.error;
        }
        checkAllLoaded();
      }
    }

    let firebaseScriptsLoaded = 0;
    function checkFirebaseLoaded() {
      firebaseScriptsLoaded++;
      if (firebaseScriptsLoaded === 2) { // Firebase App, Firestore
        initializeFirebase();
      }
    }

    reactScript.onload = checkReactLoaded;
    reactDomScript.onload = checkReactLoaded;
    babelScript.onload = checkReactLoaded;
    firebaseAppScript.onload = checkFirebaseLoaded;
    firebaseFirestoreScript.onload = checkFirebaseLoaded;

    // Fallback if scripts fail to load
    setTimeout(() => {
      if (!window.appStatus.react.loaded || !window.appStatus.firebase.loaded) {
        document.getElementById('error').innerText = 
          (window.appStatus.react.error || 'React not loaded') + ' ' + 
          (window.appStatus.firebase.error || 'Firebase not loaded');
      }
    }, 10000); // 10 seconds timeout
  </script>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Main App Component
    const App = () => {
      const [page, setPage] = useState('incoming');
      const [darkMode, setDarkMode] = useState(false);

      useEffect(() => {
        document.documentElement.className = darkMode ? 'dark' : '';
      }, [darkMode]);

      return (
        <div>
          <header className="header">
            <div className="header-content">
              <h1>Hardware Tracking</h1>
              <button
                onClick={() => setDarkMode(!darkMode)}
                className="toggle-button"
              >
                {darkMode ? 'Light' : 'Dark'}
              </button>
            </div>
            <nav className="nav">
              <div className="tabs">
                {['incoming', 'received', 'archived', 'options'].map(tab => (
                  <button
                    key={tab}
                    onClick={() => setPage(tab)}
                    className={`tab ${page === tab ? 'tab-active' : ''}`}
                  >
                    {tab.charAt(0).toUpperCase() + tab.slice(1)}
                  </button>
                ))}
              </div>
            </nav>
          </header>
          <div className="content">
            {window.appStatus.firebase.loaded ? (
              <>
                {page === 'incoming' && <p>Incoming items will be displayed here.</p>}
                {page === 'received' && <p>Received items will be displayed here.</p>}
                {page === 'archived' && <p>Archived sets will be displayed here.</p>}
                {page === 'options' && <p>Order form and buyer options will be displayed here.</p>}
              </>
            ) : (
              <p className="error">{window.appStatus.firebase.error || "Loading Firebase..."}</p>
            )}
          </div>
        </div>
      );
    };

    // Render App
    function renderApp() {
      try {
        ReactDOM.render(<App />, document.getElementById('root'));
      } catch (error) {
        console.error("React rendering failed:", error);
        document.getElementById('error').innerText = "Failed to render app: " + error.message;
      }
    }
  </script>
  <!-- Fallback Non-React Version -->
  <script type="text/javascript">
    if (!window.appStatus.react.loaded) {
      setTimeout(() => {
        if (!window.appStatus.react.loaded) {
          document.getElementById('root').innerHTML = `
            <div class="header">
              <div class="header-content">
                <h1>Hardware Tracking</h1>
                <button onclick="document.documentElement.className = document.documentElement.className === 'dark' ? '' : 'dark'">Toggle Dark Mode</button>
              </div>
              <nav class="nav">
                <div class="tabs">
                  <button class="tab tab-active">Incoming</button>
                  <button class="tab">Received</button>
                  <button class="tab">Archived</button>
                  <button class="tab">Options</button>
                </div>
              </nav>
            </div>
            <div class="content">
              <p>React failed to load. Displaying static UI.</p>
            </div>
          `;
          document.getElementById('error').innerText = "React failed to load. Using fallback UI.";
        }
      }, 5000);
    }
  </script>
</body>
</html>
