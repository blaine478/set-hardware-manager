<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SetHardware Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/ajax/libs/firebasejs/10.14.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/ajax/libs/firebasejs/10.14.1/firebase-storage.js"></script>
    <style>
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif}
        .apple-button{background:linear-gradient(to bottom,#3b82f6,#2563eb);border:none;border-radius:12px;padding:10px 20px;color:white;transition:transform .2s,box-shadow .2s}
        .apple-button:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.15)}
        .apple-input,.apple-select{border:1px solid #d1d5db;border-radius:8px;padding:8px;background:#f9fafb}
        .apple-table{border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.1)}
        .apple-modal{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.2)}
        .tab-active{background:linear-gradient(to bottom,#3b82f6,#2563eb);color:white}
        tr:hover{cursor:pointer;background-color:#f1f5f9}
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6 max-w-7xl">
        <h1 class="text-3xl font-semibold mb-6 text-center text-gray-800">SetHardware Manager</h1>
        <div class="flex gap-3 mb-6">
            <button id="main-tab" class="apple-button flex-1 py-3 tab-active">Main</button>
            <button id="input-order-tab" class="apple-button flex-1 py-3">Input Order</button>
            <button id="received-tab" class="apple-button flex-1 py-3">Received</button>
            <button id="archive-tab" class="apple-button flex-1 py-3">Archive</button>
            <button id="options-tab" class="apple-button flex-1 py-3">Options</button>
            <button id="deleted-tab" class="apple-button flex-1 py-3">Deleted</button>
        </div>

        <div id="main-page">
            <div class="mb-6 flex gap-4">
                <input id="search" type="text" placeholder="Search items..." class="apple-input flex-grow">
                <select id="filter-status" class="apple-select">
                    <option value="">All Statuses</option>
                    <option value="Ordered">Ordered</option>
                    <option value="In Transit">In Transit</option>
                    <option value="Delivered">Delivered</option>
                </select>
            </div>
            <div class="overflow-x-auto apple-table">
                <table id="item-table" class="w-full bg-white">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="p-3 text-left">Image</th>
                            <th class="p-3 text-left">Item Name</th>
                            <th class="p-3 text-left">Quantity</th>
                            <th class="p-3 text-left">Supplier</th>
                            <th class="p-3 text-left">Purchase Date</th>
                            <th class="p-3 text-left">Expected Arrival</th>
                            <th class="p-3 text-left">Cost</th>
                            <th class="p-3 text-left">Order Number</th>
                            <th class="p-3 text-left">Set Destination</th>
                            <th class="p-3 text-left">Status</th>
                            <th class="p-3 text-left">Goes To</th>
                            <th class="p-3 text-left">Received By</th>
                            <th class="p-3 text-left">Pickup Location</th>
                            <th class="p-3 text-left">Received</th>
                            <th class="p-3 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="item-table-body"></tbody>
                </table>
            </div>
        </div>

        <div id="input-order-page" class="hidden">
            <div class="mb-8 bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Add New Item</h2>
                <div class="grid gap-4 grid-cols-1 md:grid-cols-2">
                    <input id="item-name" type="text" placeholder="Item Name" class="apple-input">
                    <input id="quantity" type="number" placeholder="Quantity" class="apple-input">
                    <input id="supplier" type="text" placeholder="Supplier" class="apple-input">
                    <input id="purchase-date" type="date" placeholder="Purchase Date" class="apple-input">
                    <div id="arrival-single" class="hidden">
                        <input id="expected-arrival" type="time" step="3600" placeholder="Expected Arrival (e.g., 14:00)" class="apple-input">
                    </div>
                    <div id="arrival-range" class="hidden grid gap-2 grid-cols-2">
                        <input id="expected-arrival-start-date" type="date" placeholder="Start Date" class="apple-input">
                        <input id="expected-arrival-start-time" type="time" step="3600" placeholder="Start Time" class="apple-input">
                        <input id="expected-arrival-end-date" type="date" placeholder="End Date" class="apple-input">
                        <input id="expected-arrival-end-time" type="time" step="3600" placeholder="End Time" class="apple-input">
                    </div>
                    <input id="cost" type="number" placeholder="Cost" class="apple-input">
                    <input id="order-number" type="text" placeholder="Order Number" class="apple-input">
                    <select id="set-destination" class="apple-select">
                        <option value="">Select Set</option>
                    </select>
                    <select id="status" class="apple-select">
                        <option value="Ordered">Ordered</option>
                        <option value="In Transit">In Transit</option>
                        <option value="Delivered">Delivered</option>
                    </select>
                    <select id="goes-to" class="apple-select">
                        <option value="">Select Goes To</option>
                    </select>
                    <div class="flex gap-4">
                        <label class="flex items-center"><input type="radio" name="delivery-type" value="delivery" checked class="mr-2">Delivery</label>
                        <label class="flex items-center"><input type="radio" name="delivery-type" value="pickup" class="mr-2">Pickup</label>
                    </div>
                    <input id="pickup-location" type="text" placeholder="Pickup Location (e.g., Home Depot)" class="apple-input hidden">
                    <input id="item-image" type="file" accept="image/*" class="apple-input">
                    <button id="add-item" class="apple-button col-span-2">Add Item</button>
                </div>
            </div>
        </div>

        <div id="received-page" class="hidden">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Received Items</h2>
            <div id="received-items" class="space-y-4"></div>
        </div>

        <div id="archive-page" class="hidden">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Archived Items</h2>
            <div id="archived-items" class="space-y-4"></div>
        </div>

        <div id="options-page" class="hidden">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Manage Sets</h2>
            <div class="mb-4 flex gap-2">
                <input id="new-set-name" type="text" placeholder="New Set Name" class="apple-input flex-grow">
                <button id="add-set" class="apple-button">Add Set</button>
            </div>
            <div id="set-list" class="space-y-3"></div>
            <h2 class="text-xl font-semibold mb-4 mt-6 text-gray-800">Manage Team Members</h2>
            <div class="mb-4 flex gap-2">
                <input id="new-team-member" type="text" placeholder="New Team Member" class="apple-input flex-grow">
                <button id="add-team-member" class="apple-button">Add Team Member</button>
            </div>
            <div id="team-member-list" class="space-y-3"></div>
        </div>

        <div id="deleted-page" class="hidden">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Deleted Items</h2>
            <div id="deleted-items" class="space-y-4"></div>
        </div>

        <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-30 hidden flex items-center justify-center">
            <div class="apple-modal p-6 w-full max-w-lg">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Edit Item</h2>
                <div class="grid gap-4 grid-cols-1">
                    <input id="edit-item-id" type="hidden">
                    <input id="edit-item-name" type="text" placeholder="Item Name" class="apple-input">
                    <input id="edit-quantity" type="number" placeholder="Quantity" class="apple-input">
                    <input id="edit-supplier" type="text" placeholder="Supplier" class="apple-input">
                    <input id="edit-purchase-date" type="date" placeholder="Purchase Date" class="apple-input">
                    <div id="edit-arrival-single" class="hidden">
                        <input id="edit-expected-arrival" type="time" step="3600" placeholder="Expected Arrival (e.g., 14:00)" class="apple-input">
                    </div>
                    <div id="edit-arrival-range" class="hidden grid gap-2 grid-cols-2">
                        <input id="edit-expected-arrival-start-date" type="date" placeholder="Start Date" class="apple-input">
                        <input id="edit-expected-arrival-start-time" type="time" step="3600" placeholder="Start Time" class="apple-input">
                        <input id="edit-expected-arrival-end-date" type="date" placeholder="End Date" class="apple-input">
                        <input id="edit-expected-arrival-end-time" type="time" step="3600" placeholder="End Time" class="apple-input">
                    </div>
                    <input id="edit-cost" type="number" placeholder="Cost" class="apple-input">
                    <input id="edit-order-number" type="text" placeholder="Order Number" class="apple-input">
                    <select id="edit-set-destination" class="apple-select">
                        <option value="">Select Set</option>
                    </select>
                    <select id="edit-status" class="apple-select">
                        <option value="Ordered">Ordered</option>
                        <option value="In Transit">In Transit</option>
                        <option value="Delivered">Delivered</option>
                    </select>
                    <select id="edit-goes-to" class="apple-select">
                        <option value="">Select Goes To</option>
                    </select>
                    <div class="flex gap-4">
                        <label class="flex items-center"><input type="radio" name="edit-delivery-type" value="delivery" class="mr-2">Delivery</label>
                        <label class="flex items-center"><input type="radio" name="edit-delivery-type" value="pickup" class="mr-2">Pickup</label>
                    </div>
                    <input id="edit-pickup-location" type="text" placeholder="Pickup Location (e.g., Home Depot)" class="apple-input hidden">
                    <input id="edit-item-image" type="file" accept="image/*" class="apple-input">
                    <div class="flex gap-4">
                        <button id="save-edit" class="apple-button flex-1">Save</button>
                        <button id="delete-item" class="apple-button flex-1 bg-red-500 hover:bg-red-600">Delete</button>
                        <button id="cancel-edit" class="apple-button flex-1 bg-gray-500 hover:bg-gray-600">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="details-modal" class="fixed inset-0 bg-black bg-opacity-30 hidden flex items-center justify-center">
            <div class="apple-modal p-8 w-full max-w-2xl">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800">Item Details</h2>
                <div class="grid gap-4 grid-cols-1 md:grid-cols-2">
                    <div><strong>Name:</strong> <span id="detail-name"></span></div>
                    <div><strong>Quantity:</strong> <span id="detail-quantity"></span></div>
                    <div><strong>Supplier:</strong> <span id="detail-supplier"></span></div>
                    <div><strong>Purchase Date:</strong> <span id="detail-purchase-date"></span></div>
                    <div><strong>Expected Arrival:</strong> <span id="detail-expected-arrival"></span></div>
                    <div><strong>Cost:</strong> <span id="detail-cost"></span></div>
                    <div><strong>Order Number:</strong> <span id="detail-order-number"></span></div>
                    <div><strong>Set Destination:</strong> <span id="detail-set-destination"></span></div>
                    <div><strong>Status:</strong> <span id="detail-status"></span></div>
                    <div><strong>Goes To:</strong> <span id="detail-goes-to"></span></div>
                    <div><strong>Received By:</strong> <span id="detail-received-by"></span></div>
                    <div><strong>Delivery Type:</strong> <span id="detail-delivery-type"></span></div>
                    <div><strong>Pickup Location:</strong> <span id="detail-pickup-location"></span></div>
                    <div class="col-span-2"><strong>Image:</strong> <img id="detail-image" class="mt-2 max-w-full h-auto rounded-lg" style="max-height:200px" onerror="this.style.display='none'"></div>
                </div>
                <div class="mt-6 flex justify-end">
                    <button id="close-details" class="apple-button bg-gray-500 hover:bg-gray-600">Close</button>
                </div>
            </div>
        </div>

        <div id="received-modal" class="fixed inset-0 bg-black bg-opacity-30 hidden flex items-center justify-center">
            <div class="apple-modal p-6 w-full max-w-md">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Mark Item as Received</h2>
                <div class="grid gap-4">
                    <input id="received-item-id" type="hidden">
                    <select id="received-by" class="apple-select">
                        <option value="">Select Received By</option>
                    </select>
                    <div class="flex gap-4">
                        <button id="save-received" class="apple-button flex-1">Confirm</button>
                        <button id="cancel-received" class="apple-button flex-1 bg-gray-500 hover:bg-gray-600">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-6 flex gap-4">
            <button id="export-csv" class="apple-button">Export as CSV</button>
            <button id="export-pdf" class="apple-button">Export as PDF</button>
        </div>
    </div>

    <script>
        let db,storage;try{const e={apiKey:process.env.FIREBASE_API_KEY,authDomain:process.env.FIREBASE_AUTH_DOMAIN,projectId:process.env.FIREBASE_PROJECT_ID,storageBucket:process.env.FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.FIREBASE_MESSAGING_SENDER_ID,appId:process.env.FIREBASE_APP_ID};firebase.initializeApp(e),db=firebase.firestore(),db.enablePersistence(),storage=firebase.storage()}catch(e){}let defaultSets=[{id:"1",name:"Set A - Studio Lot"},{id:"2",name:"Set B - Warehouse 1"}],defaultTeamMembers=[{id:"1",name:"John Doe"},{id:"2",name:"Jane Smith"}];localStorage.getItem("sets")||localStorage.setItem("sets",JSON.stringify(defaultSets)),localStorage.getItem("teamMembers")||localStorage.setItem("teamMembers",JSON.stringify(defaultTeamMembers));const togglePickupLocation=()=>{const e=document.querySelector('input[name="delivery-type"]:checked');e&&document.getElementById("pickup-location").classList.toggle("hidden",e.value!=="pickup")},toggleEditPickupLocation=()=>{const e=document.querySelector('input[name="edit-delivery-type"]:checked');e&&document.getElementById("edit-pickup-location").classList.toggle("hidden",e.value!=="pickup")},toggleArrivalFields=()=>{const e=document.getElementById("status");e&&(document.getElementById("arrival-single").classList.toggle("hidden",e.value==="In Transit"),document.getElementById("arrival-range").classList.toggle("hidden",e.value!=="In Transit"))},toggleEditArrivalFields=()=>{const e=document.getElementById("edit-status");e&&(document.getElementById("edit-arrival-single").classList.toggle("hidden",e.value==="In Transit"),document.getElementById("edit-arrival-range").classList.toggle("hidden",e.value!=="In Transit"))};document.querySelectorAll('input[name="delivery-type"]').forEach(e=>e.addEventListener("change",togglePickupLocation)),document.querySelectorAll('input[name="edit-delivery-type"]').forEach(e=>e.addEventListener("change",toggleEditPickupLocation)),document.getElementById("status")?.addEventListener("change",toggleArrivalFields),document.getElementById("edit-status")?.addEventListener("change",toggleEditArrivalFields);const showPage=e=>{document.querySelectorAll("#main-page, #input-order-page, #received-page, #archive-page, #options-page, #deleted-page").forEach(e=>e.classList.add("hidden")),document.getElementById(e)?.classList.remove("hidden"),document.querySelectorAll("#main-tab, #input-order-tab, #received-tab, #archive-tab, #options-tab, #deleted-tab").forEach(e=>e.classList.add("bg-gray-500","hover:bg-gray-600").classList.remove("tab-active")),document.getElementById(`${e}-tab`)?.classList.add("tab-active").classList.remove("bg-gray-500","hover:bg-gray-600"),"main-page"===e?loadItems():"received-page"===e?loadReceivedItems():"archive-page"===e?loadArchivedItems():"options-page"===e?(loadSets(),loadTeamMembers()):"deleted-page"===e&&loadDeletedItems()};["main-tab","input-order-tab","received-tab","archive-tab","options-tab","deleted-tab"].forEach(e=>document.getElementById(e)?.addEventListener("click",()=>showPage(e.replace("-tab",""))));const loadSets=()=>{const e=document.getElementById("set-destination"),t=document.getElementById("edit-set-destination"),a=document.getElementById("set-list");if(e&&t&&a){e.innerHTML='<option value="">Select Set</option>',t.innerHTML='<option value="">Select Set</option>',a.innerHTML="";let s=JSON.parse(localStorage.getItem("sets")||"[]");navigator.onLine&&db?db.collection("sets").get().then(e=>{e.forEach(e=>{const t={id:e.id,...e.data()};s.find(a=>a.id===t.id)||s.push(t)}),localStorage.setItem("sets",JSON.stringify(s)),renderSets(s)}).then(()=>db.collection("sets").onSnapshot(loadSets)):renderSets(s)}function renderSets(s){s.forEach(s=>{const i=document.createElement("option");i.value=s.name,i.textContent=s.name,e.appendChild(i),t.appendChild(i.cloneNode(!0));const n=document.createElement("div");n.className="flex gap-2 items-center",n.innerHTML=`<input type="text" value="${s.name}" class="apple-input flex-grow" data-id="${s.id}"><button class="apple-button update-set" data-id="${s.id}">Update</button><button class="apple-button bg-red-500 hover:bg-red-600 delete-set" data-id="${s.id}">Delete</button>`,a.appendChild(n)}),a.addEventListener("click",e=>{if(e.target.classList.contains("update-set")){const t=e.target.dataset.id,a=e.target.previousElementSibling.value.trim();if(!a)return void alert("Set name cannot be empty.");const s=JSON.parse(localStorage.getItem("sets")||"[]"),i=JSON.parse(localStorage.getItem("items")||"[]"),n=JSON.parse(localStorage.getItem("receivedItems")||"[]"),r=JSON.parse(localStorage.getItem("deletedItems")||"[]"),o=s.find(e=>e.id===t);i.forEach(e=>{e.setDestination===o.name&&(e.setDestination=a)}),n.forEach(e=>{e.setDestination===o.name&&(e.setDestination=a)}),r.forEach(e=>{e.setDestination===o.name&&(e.setDestination=a)}),o.name=a,localStorage.setItem("sets",JSON.stringify(s)),localStorage.setItem("items",JSON.stringify(i)),localStorage.setItem("receivedItems",JSON.stringify(n)),localStorage.setItem("deletedItems",JSON.stringify(r)),navigator.onLine&&db&&(db.collection("sets").doc(t).set({name:a}),i.forEach(e=>{e.setDestination===a&&db.collection("items").doc(e.id).set(e)}),n.forEach(e=>{e.setDestination===a&&db.collection("receivedItems").doc(e.id).set(e)}),r.forEach(e=>{e.setDestination===a&&db.collection("deletedItems").doc(e.id).set(e)})),loadSets(),loadItems(),loadReceivedItems(),loadDeletedItems()}else if(e.target.classList.contains("delete-set")){const t=e.target.dataset.id,a=JSON.parse(localStorage.getItem("sets")||"[]"),s=JSON.parse(localStorage.getItem("items")||"[]"),i=JSON.parse(localStorage.getItem("receivedItems")||"[]"),n=JSON.parse(localStorage.getItem("deletedItems")||"[]"),r=JSON.parse(localStorage.getItem("archivedItems")||"[]"),o=a.find(e=>e.id===t),c=s.filter(e=>e.setDestination===o.name),d=i.filter(e=>e.setDestination===o.name),l=n.filter(e=>e.setDestination===o.name);c.forEach(e=>{e.archivedSet=o.name,r.push(e),navigator.onLine&&db&&db.collection("archivedItems").doc(e.id).set(e)}),d.forEach(e=>{e.archivedSet=o.name,r.push(e),navigator.onLine&&db&&db.collection("archivedItems").doc(e.id).set(e)}),l.forEach(e=>{e.archivedSet=o.name,r.push(e),navigator.onLine&&db&&db.collection("archivedItems").doc(e.id).set(e)}),localStorage.setItem("archivedItems",JSON.stringify(r)),localStorage.setItem("items",JSON.stringify(s.filter(e=>e.setDestination!==o.name))),localStorage.setItem("receivedItems",JSON.stringify(i.filter(e=>e.setDestination!==o.name))),localStorage.setItem("deletedItems",JSON.stringify(n.filter(e=>e.setDestination!==o.name))),localStorage.setItem("sets",JSON.stringify(a.filter(e=>e.id!==t))),navigator.onLine&&db&&(db.collection("sets").doc(t).delete(),c.forEach(e=>db.collection("items").doc(e.id).delete()),d.forEach(e=>db.collection("receivedItems").doc(e.id).delete()),l.forEach(e=>db.collection("deletedItems").doc(e.id).delete())),loadSets(),loadItems(),loadReceivedItems(),loadDeletedItems(),loadArchivedItems()}})}}const loadTeamMembers=()=>{const e=document.getElementById("goes-to"),t=document.getElementById("edit-goes-to"),a=document.getElementById("received-by"),s=document.getElementById("team-member-list");if(e&&t&&a&&s){e.innerHTML='<option value="">Select Goes To</option>',t.innerHTML='<option value="">Select Goes To</option>',a.innerHTML='<option value="">Select Received By</option>',s.innerHTML="";let i=JSON.parse(localStorage.getItem("teamMembers")||"[]");navigator.onLine&&db?db.collection("teamMembers").get().then(e=>{e.forEach(e=>{const t={id:e.id,...e.data()};i.find(a=>a.id===t.id)||i.push(t)}),localStorage.setItem("teamMembers",JSON.stringify(i)),renderTeamMembers(i)}).then(()=>db.collection("teamMembers").onSnapshot(loadTeamMembers)):renderTeamMembers(i)}function renderTeamMembers(i){i.forEach(i=>{const n=document.createElement("option");n.value=i.name,n.textContent=i.name,e.appendChild(n),t.appendChild(n.cloneNode(!0)),a.appendChild(n.cloneNode(!0));const r=document.createElement("div");r.className="flex gap-2 items-center",r.innerHTML=`<input type="text" value="${i.name}" class="apple-input flex-grow" data-id="${i.id}"><button class="apple-button update-team-member" data-id="${i.id}">Update</button><button class="apple-button bg-red-500 hover:bg-red-600 delete-team-member" data-id="${i.id}">Delete</button>`,s.appendChild(r)}),s.addEventListener("click",e=>{if(e.target.classList.contains("update-team-member")){const t=e.target.dataset.id,a=e.target.previousElementSibling.value.trim();if(!a)return void alert("Team member name cannot be empty.");const s=JSON.parse(localStorage.getItem("teamMembers")||"[]"),i=JSON.parse(localStorage.getItem("items")||"[]"),n=JSON.parse(localStorage.getItem("receivedItems")||"[]"),r=JSON.parse(localStorage.getItem("deletedItems")||"[]"),o=JSON.parse(localStorage.getItem("archivedItems")||"[]"),c=s.find(e=>e.id===t);i.forEach(e=>{e.goesTo===c.name&&(e.goesTo=a),e.receivedBy===c.name&&(e.receivedBy=a)}),n.forEach(e=>{e.goesTo===c.name&&(e.goesTo=a),e.receivedBy===c.name&&(e.receivedBy=a)}),r.forEach(e=>{e.goesTo===c.name&&(e.goesTo=a),e.receivedBy===c.name&&(e.receivedBy=a)}),o.forEach(e=>{e.goesTo===c.name&&(e.goesTo=a),e.receivedBy===c.name&&(e.receivedBy=a)}),c.name=a,localStorage.setItem("teamMembers",JSON.stringify(s)),localStorage.setItem("items",JSON.stringify(i)),localStorage.setItem("receivedItems",JSON.stringify(n)),localStorage.setItem("deletedItems",JSON.stringify(r)),localStorage.setItem("archivedItems",JSON.stringify(o)),navigator.onLine&&db&&(db.collection("teamMembers").doc(t).set({name:a}),i.forEach(e=>{(e.goesTo===a||e.receivedBy===a)&&db.collection("items").doc(e.id).set(e)}),n.forEach(e=>{(e.goesTo===a||e.receivedBy===a)&&db.collection("receivedItems").doc(e.id).set(e)}),r.forEach(e=>{(e.goesTo===a||e.receivedBy===a)&&db.collection("deletedItems").doc(e.id).set(e)}),o.forEach(e=>{(e.goesTo===a||e.receivedBy===a)&&db.collection("archivedItems").doc(e.id).set(e)})),loadTeamMembers(),loadItems(),loadReceivedItems(),loadDeletedItems(),loadArchivedItems()}else if(e.target.classList.contains("delete-team-member")){const t=e.target.dataset.id,a=JSON.parse(localStorage.getItem("teamMembers")||"[]"),s=JSON.parse(localStorage.getItem("items")||"[]"),i=JSON.parse(localStorage.getItem("receivedItems")||"[]"),n=JSON.parse(localStorage.getItem("deletedItems")||"[]"),r=JSON.parse(localStorage.getItem("archivedItems")||"[]"),o=a.find(e=>e.id===t);s.forEach(e=>{e.goesTo===o.name&&(e.goesTo=""),e.receivedBy===o.name&&(e.receivedBy="")}),i.forEach(e=>{e.goesTo===o.name&&(e.goesTo=""),e.receivedBy===o.name&&(e.receivedBy="")}),n.forEach(e=>{e.goesTo===o.name&&(e.goesTo=""),e.receivedBy===o.name&&(e.receivedBy="")}),r.forEach(e=>{e.goesTo===o.name&&(e.goesTo=""),e.receivedBy===o.name&&(e.receivedBy="")}),localStorage.setItem("teamMembers",JSON.stringify(a.filter(e=>e.id!==t))),localStorage.setItem("items",JSON.stringify(s)),localStorage.setItem("receivedItems",JSON.stringify(i)),localStorage.setItem("deletedItems",JSON.stringify(n)),localStorage.setItem("archivedItems",JSON.stringify(r)),navigator.onLine&&db&&(db.collection("teamMembers").doc(t).delete(),s.forEach(e=>{(e.goesTo===""||e.receivedBy==="")&&db.collection("items").doc(e.id).set(e)}),i.forEach(e=>{(e.goesTo===""||e.receivedBy==="")&&db.collection("receivedItems").doc(e.id).set(e)}),n.forEach(e=>{(e.goesTo===""||e.receivedBy==="")&&db.collection("deletedItems").doc(e.id).set(e)}),r.forEach(e=>{(e.goesTo===""||e.receivedBy==="")&&db.collection("archivedItems").doc(e.id).set(e)})),loadTeamMembers(),loadItems(),loadReceivedItems(),loadDeletedItems(),loadArchivedItems()}})}}document.getElementById("add-team-member")?.addEventListener("click",()=>{const e=document.getElementById("new-team-member").value.trim();if(!e)return void alert("Team member name cannot be empty.");const t=JSON.parse(localStorage.getItem("teamMembers")||"[]");t.push({id:Date.now().toString(),name:e}),localStorage.setItem("teamMembers",JSON.stringify(t)),navigator.onLine&&db&&db.collection("teamMembers").doc(t[t.length-1].id).set(t[t.length-1]),document.getElementById("new-team-member").value="",loadTeamMembers()});const saveItem=e=>{const t=JSON.parse(localStorage.getItem("items")||"[]");t.push(e),localStorage.setItem("items",JSON.stringify(t)),navigator.onLine&&db&&db.collection("items").doc(e.id).set(e),loadItems(),document.getElementById("item-name").value="",document.getElementById("quantity").value="",document.getElementById("supplier").value="",document.getElementById("purchase-date").value="",document.getElementById("expected-arrival").value="",document.getElementById("expected-arrival-start-date").value="",document.getElementById("expected-arrival-start-time").value="",document.getElementById("expected-arrival-end-date").value="",document.getElementById("expected-arrival-end-time").value="",document.getElementById("cost").value="",document.getElementById("order-number").value="",document.getElementById("set-destination").value="",document.getElementById("status").value="Ordered",document.getElementById("goes-to").value="",document.getElementById("pickup-location").value="",document.getElementById("item-image").value="",document.querySelector('input[name="delivery-type"][value="delivery"]').checked=!0,togglePickupLocation(),toggleArrivalFields()},loadItems=()=>{const e=document.getElementById("item-table-body");if(e){e.innerHTML="";let t=JSON.parse(localStorage.getItem("items")||"[]");navigator.onLine&&db?db.collection("items").get().then(a=>{a.forEach(a=>{const s={id:a.id,...a.data()};t.find(e=>e.id===s.id)||t.push(s)}),localStorage.setItem("items",JSON.stringify(t)),renderItems(t)}).then(()=>db.collection("items").onSnapshot(loadItems)):renderItems(t)}function renderItems(t){const a=JSON.parse(localStorage.getItem("teamMembers")||"[]"),s=document.getElementById("search").value.toLowerCase(),i=document.getElementById("filter-status").value;t.filter(e=>!s||e.name.toLowerCase().includes(s)&&(!i||e.status===i)).forEach(t=>{const n=document.createElement("tr");n.className="hover:bg-gray-100 transition";const r=t.status==="In Transit"&&t.expectedArrivalStartDate?`${t.expectedArrivalStartDate} ${t.expectedArrivalStartTime} - ${t.expectedArrivalEndDate} ${t.expectedArrivalEndTime}`:t.expectedArrival||"";n.innerHTML=`<td class="p-3"><img src="${t.image||""}" class="w-10 h-10 object-cover rounded" onerror="this.style.display='none'"></td><td class="p-3">${t.name}</td><td class="p-3">${t.quantity}</td><td class="p-3">${t.supplier}</td><td class="p-3">${t.purchaseDate}</td><td class="p-3">${r}</td><td class="p-3">$${t.cost}</td><td class="p-3">${t.orderNumber}</td><td class="p-3">${t.setDestination}</td><td class="p-3"><span class="px-2 py-1 rounded text-white ${t.status==="Ordered"?"bg-yellow-500":t.status==="In Transit"?"bg-blue-500":"bg-green-500"}">${t.status}</span></td><td class="p-3">${t.goesTo||""}</td><td class="p-3">${t.receivedBy||""}</td><td class="p-3">${t.pickupLocation||""}</td><td class="p-3"><button class="mark-received apple-button text-sm" data-id="${t.id}">Mark Received</button></td><td class="p-3"><button class="edit-item apple-button text-sm" data-id="${t.id}">Edit</button></td>`,e.appendChild(n)}),e.addEventListener("click",e=>{const a=e.target;if(a.classList.contains("edit-item")){const e=a.dataset.id,s=t.find(t=>t.id===e);document.getElementById("edit-item-id").value=e,document.getElementById("edit-item-name").value=s.name,document.getElementById("edit-quantity").value=s.quantity,document.getElementById("edit-supplier").value=s.supplier,document.getElementById("edit-purchase-date").value=s.purchaseDate,document.getElementById("edit-expected-arrival").value=s.expectedArrival||"",document.getElementById("edit-expected-arrival-start-date").value=s.expectedArrivalStartDate||"",document.getElementById("edit-expected-arrival-start-time").value=s.expectedArrivalStartTime||"",document.getElementById("edit-expected-arrival-end-date").value=s.expectedArrivalEndDate||"",document.getElementById("edit-expected-arrival-end-time").value=s.expectedArrivalEndTime||"",document.getElementById("edit-cost").value=s.cost,document.getElementById("edit-order-number").value=s.orderNumber,document.getElementById("edit-set-destination").value=s.setDestination,document.getElementById("edit-status").value=s.status,document.getElementById("edit-goes-to").value=s.goesTo||"",document.querySelector(`input[name="edit-delivery-type"][value="${s.deliveryType||"delivery"}"]`).checked=!0,document.getElementById("edit-pickup-location").value=s.pickupLocation||"",toggleEditPickupLocation(),toggleEditArrivalFields(),document.getElementById("edit-modal").classList.remove("hidden")}else if(a.classList.contains("mark-received")){const e=a.dataset.id;document.getElementById("received-item-id").value=e,document.getElementById("received-modal").classList.remove("hidden")}else{const e=t.find(t=>t.id===a.closest("tr").querySelector(".edit-item").dataset.id);document.getElementById("detail-name").textContent=e.name,document.getElementById("detail-quantity").textContent=e.quantity,document.getElementById("detail-supplier").textContent=e.supplier,document.getElementById("detail-purchase-date").textContent=e.purchaseDate||"N/A",document.getElementById("detail-expected-arrival").textContent=e.status==="In Transit"&&e.expectedArrivalStartDate?`${e.expectedArrivalStartDate} ${e.expectedArrivalStartTime} - ${e.expectedArrivalEndDate} ${e.expectedArrivalEndTime}`:e.expectedArrival||"",document.getElementById("detail-cost").textContent=e.cost?`$${e.cost}`:"N/A",document.getElementById("detail-order-number").textContent=e.orderNumber||"N/A",document.getElementById("detail-set-destination").textContent=e.setDestination,document.getElementById("detail-status").textContent=e.status,document.getElementById("detail-goes-to").textContent=e.goesTo||"N/A",document.getElementById("detail-received-by").textContent=e.receivedBy||"N/A",document.getElementById("detail-delivery-type").textContent=e.deliveryType||"N/A",document.getElementById("detail-pickup-location").textContent=e.pickupLocation||"N/A",document.getElementById("detail-image").src=e.image||"",document.getElementById("details-modal").classList.remove("hidden")}})}}document.getElementById("add-item")?.addEventListener("click",async()=>{const e=document.getElementById("status").value,t={id:Date.now().toString(),name:document.getElementById("item-name").value,quantity:document.getElementById("quantity").value,supplier:document.getElementById("supplier").value,purchaseDate:document.getElementById("purchase-date").value,expectedArrival:e!=="In Transit"?document.getElementById("expected-arrival").value:"",expectedArrivalStartDate:e==="In Transit"?document.getElementById("expected-arrival-start-date").value:"",expectedArrivalStartTime:e==="In Transit"?document.getElementById("expected-arrival-start-time").value:"",expectedArrivalEndDate:e==="In Transit"?document.getElementById("expected-arrival-end-date").value:"",expectedArrivalEndTime:e==="In Transit"?document.getElementById("expected-arrival-end-time").value:"",cost:document.getElementById("cost").value,orderNumber:document.getElementById("order-number").value,setDestination:document.getElementById("set-destination").value,status:e,goesTo:document.getElementById("goes-to").value,receivedBy:"",deliveryType:document.querySelector('input[name="delivery-type"]:checked')?.value||"delivery",pickupLocation:document.querySelector('input[name="delivery-type"]:checked')?.value==="pickup"?document.getElementById("pickup-location").value:"",image:""};if(!t.name||!t.quantity||!t.setDestination||!t.status)return void alert("Please fill in Name, Quantity, Set Destination, and Status.");if(t.status==="In Transit"&&(!t.expectedArrivalStartDate||!t.expectedArrivalStartTime||!t.expectedArrivalEndDate||!t.expectedArrivalEndTime))return void alert("Please fill in both arrival dates and times for In Transit status.");const a=document.getElementById("item-image").files[0];if(navigator.onLine&&a&&storage){try{const e=storage.ref(`images/${t.id}`);await e.put(a),t.image=await e.getDownloadURL()}catch(e){}}else if(a){const e=new FileReader;e.onload=e=>{t.image=e.target.result,saveItem(t)},e.readAsDataURL(a);return}saveItem(t)}),document.getElementById("save-edit")?.addEventListener("click",async()=>{const e=JSON.parse(localStorage.getItem("items")||"[]"),t=document.getElementById("edit-item-id").value,a=e.findIndex(e=>e.id===t),s=document.getElementById("edit-status").value,i=document.getElementById("edit-item-image").files[0],n={id:t,name:document.getElementById("edit-item-name").value,quantity:document.getElementById("edit-quantity").value,supplier:document.getElementById("edit-supplier").value,purchaseDate:document.getElementById("edit-purchase-date").value,expectedArrival:s!=="In Transit"?document.getElementById("edit-expected-arrival").value:"",expectedArrivalStartDate:s==="In Transit"?document.getElementById("edit-expected-arrival-start-date").value:"",expectedArrivalStartTime:s==="In Transit"?document.getElementById("edit-expected-arrival-start-time").value:"",expectedArrivalEndDate:s==="In Transit"?document.getElementById("edit-expected-arrival-end-date").value:"",expectedArrivalEndTime:s==="In Transit"?document.getElementById("edit-expected-arrival-end-time").value:"",cost:document.getElementById("edit-cost").value,orderNumber:document.getElementById("edit-order-number").value,setDestination:document.getElementById("edit-set-destination").value,status:s,goesTo:document.getElementById("edit-goes-to").value,receivedBy:e[a].receivedBy||"",deliveryType:document.querySelector('input[name="edit-delivery-type"]:checked')?.value||"delivery",pickupLocation:document.querySelector('input[name="edit-delivery-type"]:checked')?.value==="pickup"?document.getElementById("edit-pickup-location").value:"",image:e[a].image};if(!n.name||!n.quantity||!n.setDestination||!n.status)return void alert("Please fill in Name, Quantity, Set Destination, and Status.");if(n.status==="In Transit"&&(!n.expectedArrivalStartDate||!n.expectedArrivalStartTime||!n.expectedArrivalEndDate||!n.expectedArrivalEndTime))return void alert("Please fill in both arrival dates and times for In Transit status.");if(navigator.onLine&&i&&storage){try{const e=storage.ref(`images/${n.id}`);await e.put(i),n.image=await e.getDownloadURL()}catch(e){}}else if(i){const t=new FileReader;t.onload=t=>{n.image=t.target.result,e[a]=n,localStorage.setItem("items",JSON.stringify(e)),navigator.onLine&&db&&db.collection("items").doc(n.id).set(n),loadItems(),document.getElementById("edit-modal").classList.add("hidden")},t.readAsDataURL(i);return}e[a]=n,localStorage.setItem("items",JSON.stringify(e)),navigator.onLine&&db&&db.collection("items").doc(n.id).set(n),loadItems(),document.getElementById("edit-modal").classList.add("hidden")}),document.getElementById("delete-item")?.addEventListener("click",()=>{const e=document.getElementById("edit-item-id").value,t=JSON.parse(localStorage.getItem("items")||"[]"),a=JSON.parse(localStorage.getItem("deletedItems")||"[]"),s=t.find(t=>t.id===e);s.deletionTimestamp=Date.now(),a.push(s),localStorage.setItem("items",JSON.stringify(t.filter(t=>t.id!==e))),localStorage.setItem("deletedItems",JSON.stringify(a)),navigator.onLine&&db&&(db.collection("items").doc(s.id).delete(),db.collection("deletedItems").doc(s.id).set(s)),loadItems(),loadDeletedItems(),document.getElementById("edit-modal").classList.add("hidden")}),document.getElementById("save-received")?.addEventListener("click",()=>{const e=document.getElementById("received-item-id").value,t=document.getElementById("received-by").value;if(!t)return void alert("Please select who received the item.");const a=JSON.parse(localStorage.getItem("items")||"[]"),s=JSON.parse(localStorage.getItem("receivedItems")||"[]"),i=a.find(t=>t.id===e);i.received=!0,i.receivedBy=t,s.push(i),localStorage.setItem("items",JSON.stringify(a.filter(t=>t.id!==e))),localStorage.setItem("receivedItems",JSON.stringify(s)),navigator.onLine&&db&&(db.collection("items").doc(i.id).delete(),db.collection("receivedItems").doc(i.id).set(i)),loadItems(),loadReceivedItems(),document.getElementById("received-modal").classList.add("hidden")}),document.getElementById("cancel-received")?.addEventListener("click",()=>{document.getElementById("received-modal").classList.add("hidden")}),document.getElementById("cancel-edit")?.addEventListener("click",()=>{document.getElementById("edit-modal").classList.add("hidden")}),document.getElementById("close-details")?.addEventListener("click",()=>{document.getElementById("details-modal").classList.add("hidden")}),document.getElementById("search")?.addEventListener("input",loadItems),document.getElementById("filter-status")?.addEventListener("change",loadItems);const loadReceivedItems=()=>{const e=document.getElementById("received-items");if(e){e.innerHTML="";let t=JSON.parse(localStorage.getItem("receivedItems")||"[]");navigator.onLine&&db?db.collection("receivedItems").get().then(a=>{a.forEach(a=>{const s={id:a.id,...a.data()};t.find(e=>e.id===s.id)||t.push(s)}),localStorage.setItem("receivedItems",JSON.stringify(t)),renderReceivedItems(t)}).then(()=>db.collection("receivedItems").onSnapshot(loadReceivedItems)):renderReceivedItems(t)}function renderReceivedItems(t){const a=[...new Set(t.map(e=>e.setDestination))];a.forEach(a=>{const s=document.createElement("div");s.className="bg-white p-4 rounded-2xl shadow-lg mb-4",s.innerHTML=`<h3 class="text-lg font-semibold mb-2">${a}</h3>`;const i=document.createElement("table");i.className="w-full",i.innerHTML=`<thead><tr class="bg-gray-100"><th class="p-3 text-left">Image</th><th class="p-3 text-left">Item Name</th><th class="p-3 text-left">Quantity</th><th class="p-3 text-left">Supplier</th><th class="p-3 text-left">Purchase Date</th><th class="p-3 text-left">Expected Arrival</th><th class="p-3 text-left">Cost</th><th class="p-3 text-left">Order Number</th><th class="p-3 text-left">Status</th><th class="p-3 text-left">Goes To</th><th class="p-3 text-left">Received By</th><th class="p-3 text-left">Pickup Location</th></tr></thead><tbody>${t.filter(e=>e.setDestination===a).map(e=>{const t=e.status==="In Transit"&&e.expectedArrivalStartDate?`${e.expectedArrivalStartDate} ${e.expectedArrivalStartTime} - ${e.expectedArrivalEndDate} ${e.expectedArrivalEndTime}`:e.expectedArrival||"";return`<tr class="hover:bg-gray-100 transition"><td class="p-3"><img src="${e.image||""}" class="w-10 h-10 object-cover rounded" onerror="this.style.display='none'"></td><td class="p-3">${e.name}</td><td class="p-3">${e.quantity}</td><td class="p-3">${e.supplier}</td><td class="p-3">${e.purchaseDate}</td><td class="p-3">${t}</td><td class="p-3">$${e.cost}</td><td class="p-3">${e.orderNumber}</td><td class="p-3"><span class="px-2 py-1 rounded text-white ${e.status==="Ordered"?"bg-yellow-500":e.status==="In Transit"?"bg-blue-500":"bg-green-500"}">${e.status}</span></td><td class="p-3">${e.goesTo||""}</td><td class="p-3">${e.receivedBy||""}</td><td class="p-3">${e.pickupLocation||""}</td></tr>`}).join("")}</tbody>`,s.appendChild(i),e.appendChild(s)})}},loadArchivedItems=()=>{const e=document.getElementById("archived-items");if(e){e.innerHTML="";let t=JSON.parse(localStorage.getItem("archivedItems")||"[]");navigator.onLine&&db?db.collection("archivedItems").get().then(a=>{a.forEach(a=>{const s={id:a.id,...a.data()};t.find(e=>e.id===s.id)||t.push(s)}),localStorage.setItem("archivedItems",JSON.stringify(t)),renderArchivedItems(t)}).then(()=>db.collection("archivedItems").onSnapshot(loadArchivedItems)):renderArchivedItems(t)}function renderArchivedItems(t){const a=[...new Set(t.map(e=>e.archivedSet))];a.forEach(a=>{const s=document.createElement("div");s.className="bg-white p-4 rounded-2xl shadow-lg mb-4",s.innerHTML=`<h3 class="text-lg font-semibold mb-2">${a}</h3>`;const i=document.createElement("table");i.className="w-full",i.innerHTML=`<thead><tr class="bg-gray-100"><th class="p-3 text-left">Image</th><th class="p-3 text-left">Item Name</th><th class="p-3 text-left">Quantity</th><th class="p-3 text-left">Supplier</th><th class="p-3 text-left">Purchase Date</th><th class="p-3 text-left">Expected Arrival</th><th class="p-3 text-left">Cost</th><th class="p-3 text-left">Order Number</th><th class="p-3 text-left">Status</th><th class="p-3 text-left">Goes To</th><th class="p-3 text-left">Received By</th><th class="p-3 text-left">Pickup Location</th></tr></thead><tbody>${t.filter(e=>e.archivedSet===a).map(e=>{const t=e.status==="In Transit"&&e.expectedArrivalStartDate?`${e.expectedArrivalStartDate} ${e.expectedArrivalStartTime} - ${e.expectedArrivalEndDate} ${e.expectedArrivalEndTime}`:e.expectedArrival||"";return`<tr class="hover:bg-gray-100 transition"><td class="p-3"><img src="${e.image||""}" class="w-10 h-10 object-cover rounded" onerror="this.style.display='none'"></td><td class="p-3">${e.name}</td><td class="p-3">${e.quantity}</td><td class="p-3">${e.supplier}</td><td class="p-3">${e.purchaseDate}</td><td class="p-3">${t}</td><td class="p-3">$${e.cost}</td><td class="p-3">${e.orderNumber}</td><td class="p-3"><span class="px-2 py-1 rounded text-white ${e.status==="Ordered"?"bg-yellow-500":e.status==="In Transit"?"bg-blue-500":"bg-green-500"}">${e.status}</span></td><td class="p-3">${e.goesTo||""}</td><td class="p-3">${e.receivedBy||""}</td><td class="p-3">${e.pickupLocation||""}</td></tr>`}).join("")}</tbody>`,s.appendChild(i),e.appendChild(s)})}},loadDeletedItems=()=>{const e=document.getElementById("deleted-items");if(e){e.innerHTML="";let t=JSON.parse(localStorage.getItem("deletedItems")||"[]"),a=Date.now()-6048e5;t=a.filter(e=>e.deletionTimestamp>a),localStorage.setItem("deletedItems",JSON.stringify(t)),navigator.onLine&&db?db.collection("deletedItems").get().then(s=>{s.forEach(s=>{const i={id:s.id,...s.data()};i.deletionTimestamp>a&&!t.find(e=>e.id===i.id)&&t.push(i)}),t=t.filter(e=>e.deletionTimestamp>a),localStorage.setItem("deletedItems",JSON.stringify(t)),db.collection("deletedItems").get().then(e=>{e.forEach(e=>{e.data().deletionTimestamp<=a&&db.collection("deletedItems").doc(e.id).delete())}),renderDeletedItems(t)}).then(()=>db.collection("deletedItems").onSnapshot(loadDeletedItems)):renderDeletedItems(t)}function renderDeletedItems(t){const a=[...new Set(t.map(e=>e.setDestination))];a.forEach(a=>{const s=document.createElement("div");s.className="bg-white p-4 rounded-2xl shadow-lg mb-4",s.innerHTML=`<h3 class="text-lg font-semibold mb-2">${a}</h3>`;const i=document.createElement("table");i.className="w-full",i.innerHTML=`<thead><tr class="bg-gray-100"><th class="p-3 text-left">Image</th><th class="p-3 text-left">Item Name</th><th class="p-3 text-left">Quantity</th><th class="p-3 text-left">Supplier</th><th class="p-3 text-left">Purchase Date</th><th class="p-3 text-left">Expected Arrival</th><th class="p-3 text-left">Cost</th><th class="p-3 text-left">Order Number</th><th class="p-3 text-left">Status</th><th class="p-3 text-left">Goes To</th><th class="p-3 text-left">Received By</th><th class="p-3 text-left">Pickup Location</th><th class="p-3 text-left">Deletion Date</th><th class="p-3 text-left">Actions</th></tr></thead><tbody>${t.filter(e=>e.setDestination===a).map(e=>{const t=e.status==="In Transit"&&e.expectedArrivalStartDate?`${e.expectedArrivalStartDate} ${e.expectedArrivalStartTime} - ${e.expectedArrivalEndDate} ${e.expectedArrivalEndTime}`:e.expectedArrival||"",a=new Date(e.deletionTimestamp).toLocaleDateString("en-US");return`<tr class="hover:bg-gray-100 transition"><td class="p-3"><img src="${e.image||""}" class="w-10 h-10 object-cover rounded" onerror="this.style.display='none'"></td><td class="p-3">${e.name}</td><td class="p-3">${e.quantity}</td><td class="p-3">${e.supplier}</td><td class="p-3">${e.purchaseDate}</td><td class="p-3">${t}</td><td class="p-3">$${e.cost}</td><td class="p-3">${e.orderNumber}</td><td class="p-3"><span class="px-2 py-1 rounded text-white ${e.status==="Ordered"?"bg-yellow-500":e.status==="In Transit"?"bg-blue-500":"bg-green-500"}">${e.status}</span></td><td class="p-3">${e.goesTo||""}</td><td class="p-3">${e.receivedBy||""}</td><td class="p-3">${e.pickupLocation||""}</td><td class="p-3">${a}</td><td class="p-3"><button class="restore-item apple-button text-sm bg-green-500 hover:bg-green-600" data-id="${e.id}">Restore Order</button></td></tr>`}).join("")}</tbody>`,s.appendChild(i),e.appendChild(s)}),e.addEventListener("click",e=>{if(e.target.classList.contains("restore-item")){const a=e.target.dataset.id,s=JSON.parse(localStorage.getItem("deletedItems")||"[]"),i=JSON.parse(localStorage.getItem("items")||"[]"),n=s.find(e=>e.id===a);delete n.deletionTimestamp,n.received=!1,n.receivedBy="",i.push(n),localStorage.setItem("items",JSON.stringify(i)),localStorage.setItem("deletedItems",JSON.stringify(s.filter(e=>e.id!==a))),navigator.onLine&&db&&(db.collection("deletedItems").doc(n.id).delete(),db.collection("items").doc(n.id).set(n)),loadItems(),loadDeletedItems()}})}}const escapeCsvValue=e=>e?String(e).includes(",")||String(e).includes('"')||String(e).includes("\n")?`"${String(e).replace(/"/g,'""')}"`:String(e):"";document.getElementById("export-csv")?.addEventListener("click",()=>{const e=JSON.parse(localStorage.getItem("items")||"[]"),t=JSON.parse(localStorage.getItem("receivedItems")||"[]"),a=JSON.parse(localStorage.getItem("deletedItems")||"[]"),s=JSON.parse(localStorage.getItem("archivedItems")||"[]"),i=Date.now()-6048e5,n=[...e.map(e=>({...e,state:"Active"})),...t.map(e=>({...e,state:"Received"})),...a.filter(e=>e.deletionTimestamp>i).map(e=>({...e,state:"Deleted",deletionDate:new Date(e.deletionTimestamp).toLocaleDateString("en-US")})),...s.map(e=>({...e,state:"Archived"}))],r=["Item Name","Quantity","Supplier","Purchase Date","Expected Arrival","Expected Arrival Start Date","Expected Arrival Start Time","Expected Arrival End Date","Expected Arrival End Time","Cost","Order Number","Set Destination","Status","Goes To","Received By","Delivery Type","Pickup Location","State","Deletion Date","Archived Set"],o=n.map(e=>{const t=e.status==="In Transit"&&e.expectedArrivalStartDate?`${e.expectedArrivalStartDate} ${e.expectedArrivalStartTime} - ${e.expectedArrivalEndDate} ${e.expectedArrivalEndTime}`:e.expectedArrival||"";return[escapeCsvValue(e.name),escapeCsvValue(e.quantity),escapeCsvValue(e.supplier),escapeCsvValue(e.purchaseDate),escapeCsvValue(t),escapeCsvValue(e.expectedArrivalStartDate||""),escapeCsvValue(e.expectedArrivalStartTime||""),escapeCsvValue(e.expectedArrivalEndDate||""),escapeCsvValue(e.expectedArrivalEndTime||""),escapeCsvValue(e.cost?`$${e.cost}`:""),escapeCsvValue(e.orderNumber),escapeCsvValue(e.setDestination),escapeCsvValue(e.status),escapeCsvValue(e.goesTo||""),escapeCsvValue(e.receivedBy||""),escapeCsvValue(e.deliveryType),escapeCsvValue(e.pickupLocation||""),escapeCsvValue(e.state),escapeCsvValue(e.deletionDate||""),escapeCsvValue(e.archivedSet||"")].join(",")}),c=[r.join(","),...o].join("\n"),d=new Blob([c],{type:"text/csv"}),l=URL.createObjectURL(d),m=document.createElement("a");m.href=l,m.download=`SetHardware_Inventory_${new Date().toISOString().split("T")[0]}.csv`,m.click(),URL.revokeObjectURL(l)}),document.getElementById("export-pdf")?.addEventListener("click",()=>{const e=window.jspdf.jsPDF,t=new e;t.setFont("helvetica","normal"),t.setFontSize(16),t.text("SetHardware Manager - Inventory Report",20,20),t.setFontSize(10),t.text(`Generated on: ${new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}`,20,30),t.setLineWidth(.5),t.line(20,35,190,35);let a=45;const s=JSON.parse(localStorage.getItem("items")||"[]"),i=JSON.parse(localStorage.getItem("receivedItems")||"[]"),n=JSON.parse(localStorage.getItem("deletedItems")||"[]"),r=JSON.parse(localStorage.getItem("archivedItems")||"[]"),o=Date.now()-6048e5,c=[...s.map(e=>({...e,state:"Active"})),...i.map(e=>({...e,state:"Received"})),...n.filter(e=>e.deletionTimestamp>o).map(e=>({...e,state:"Deleted",deletionDate:new Date(e.deletionTimestamp).toLocaleDateString("en-US")})),...r.map(e=>({...e,state:"Archived"}))],d=[...new Set(c.map(e=>e.setDestination||e.archivedSet))];d.forEach(s=>{a>260&&(t.addPage(),a=20),t.setFontSize(12),t.setFont("helvetica","bold"),t.text(`Set: ${s||"Unassigned"}`,20,a),a+=10,t.setFontSize(10),t.setFont("helvetica","normal");const i=c.filter(e=>e.setDestination===s||e.archivedSet===s),n=["Item Name","Qty","Supplier","Purchase Date","Expected Arrival","Cost","Order #","Status","Goes To","Received By","Delivery","Pickup","State","Deletion Date"],r=i.map(e=>{const t=e.status==="In Transit"&&e.expectedArrivalStartDate?`${e.expectedArrivalStartDate} ${e.expectedArrivalStartTime} - ${e.expectedArrivalEndDate} ${e.expectedArrivalEndTime}`:e.expectedArrival||"";return[e.name,e.quantity,e.supplier||"",e.purchaseDate||"",t,e.cost?`$${e.cost}`:"",e.orderNumber||"",e.status,e.goesTo||"",e.receivedBy||"",e.deliveryType||"",e.pickupLocation||"",e.state,e.deletionDate||""]});t.autoTable({startY:a,head:[n],body:r,theme:"grid",headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontSize:10},bodyStyles:{fontSize:9},columnStyles:{0:{cellWidth:30},1:{cellWidth:10},2:{cellWidth:20},3:{cellWidth:20},4:{cellWidth:30},5:{cellWidth:15},6:{cellWidth:20},7:{cellWidth:15},8:{cellWidth:15},9:{cellWidth:15},10:{cellWidth:15},11:{cellWidth:15},12:{cellWidth:15},13:{cellWidth:15}},margin:{left:20,right:20}}),a=t.lastAutoTable.finalY+10;const d=i.reduce((e,t)=>e+(parseFloat(t.cost)||0),0);t.text(`Total Cost for ${s||"Unassigned"}: $${d.toFixed(2)}`,20,a),a+=15}),t.setFontSize(8),t.text(`Page ${t.getCurrentPageInfo().pageNumber}`,190,290,{align:"right"}),t.save(`SetHardware_Inventory_${new Date().toISOString().split("T")[0]}.pdf`)}),togglePickupLocation(),toggleArrivalFields(),loadSets(),loadTeamMembers(),showPage("main-page");
    </script>
</body>
</html>
